---
title: "8장 통계분석"
author: "양승학"
date: '2022-03-15'
output: 
 html_document:
   keep_md: True

---



```r
library(VennDiagram)
```

```
## Warning: 패키지 'VennDiagram'는 R 버전 4.1.3에서 작성되었습니다
```

```
## 필요한 패키지를 로딩중입니다: grid
```

```
## 필요한 패키지를 로딩중입니다: futile.logger
```

```
## Warning: 패키지 'futile.logger'는 R 버전 4.1.3에서 작성되었습니다
```

## 1)기술통계
-평균, 최솟값, 최대값, 중앙값과 같이 데이터 특징을
 알려주는 값
- 기술통계는 Descriptive 라고 한고
  기술통계는 사실 확인에 해당된다

## 2) 추론통계
- 변수 간의 관계를 파악하고, 이를 토대로 변수 간의
  인관관계나 새로운 사실들을 밝혀내는 것을
  추론통계(inferential statistics)라고 한다
  데이터 분석에서 하는 추론 통게는
  평균 차이 검정,교차분석,상관관계분석,회귀분석 등이 있다.
  
## 2-1) 평균차이검정
- 집단별로 평균의 차이가 실제로 있는가를 검정하는 것
  고등학교 성적을 예로 들면 남학생 집단의 평균은 82.1점이고
  여학생 집단의 성적이 82.3점이라 가정했을 때 여학생 집단이
  남학생 집단 보다 0.2점이 높다 그렇다고 여학생 집단의
  성적이 남학생 보다 높다고 단정할 수 있을까? 과거에는
  남학생 집단 평균이 높은 적이 있었고 이번에는 우연히
  여학생의 집단 평균이 높았을 수도 있다 때문에 이번 성적의
  결과가 "의미 있다". 즉 "여학생 집단의 평균 성적이 남학생
  집단보다 일반적으로 높다"고 결론을 내리기 위해서는 먼저
  이번 성적의 결과가 우연하게 발생한 것이 아니라는 것을
  통계적으로 검정해야 한다.
  
## 2-2) 교차분석
  범주형 변수로 구성된 집단들의 관련성을 검정하는
  통계분석이다. 교차분석은 카이제곱(χ2)검정,카이스퀘어검정,   독립성 검정이라고도 한다. 한 아파트 단지에 100세대
  살고 있다. 집 크기는 소형이 50세대,대형이 50세대다.
  이 단지의 TV 크기는 소형, 대형 등 두 종류이다. 집이 크면
  대형 TV를 보유하고, 집이 작으면 소형 TV를 보유하는지,
  즉 집의 크기와 TV 크기가 관계가 있는지를 통계적으로
  분석하는 것이 교차분석 검정이다. 아파트 크기가 TV 크기는    모두 범주형이어서 평균 차이 검정을 할 수 없다.
   분석 결과는 관계가 있다,없다 등 두가지다. 확률적으로는
  이 단지의 TV보유 상황은 소형 50대, 대형 50인 것으로
  생각할 수 있다. 그런데 90세대가 대형 TV를 보유하고,
  10세대가 소형 TV를 보유하고 있다면, 아파트 크기와
  TV 크기는 관계가 없다. 이런 경우는
  "아파트 크기와 TV크기는 독립적이다" 또는 "아파트 크기에
  따라 TV크기는 차이가 없다"고 한다. 그러나 55세대가 대형
  TV를 보유하고, 45세대가 소형TV를 보유하고 있으면 아파트
  크기와 TV 크기는 관계가 있다고 추론 할 수 있다.
  이런 경우 "아파트 크기와 TV 크기는 독립적이지 않다" 또는
  "아파트 크기에 따라 TV 크기는 차이가 있다"고 한다.
  교차분석 검정의 목적은 두 변수 사이에 "관계가 있다"는
  것을 알아보는 것이다.
  
## 2-3) 상관관계분석
  상관관계분석은 변수 간의 상관관계(correlation)를
  알아보는 것이다. 상관관계는 변수간의 연관성이다.
  한 변수가 변화하면 다른 변수도 변화하는 관계이다.
  집합에서 여러 집단들이 교차해 있는 공집합의 관계를
  생각하면 된다. 상관관계에서는 관계의 강도와 방향이
  중요하다. 강도는 한 변수가 변화할 때 다른 변수가
  변화하는 정도이다. 방향은 한 변수가 변화 할 때 다른 변수가
  같은 방향으로 변화하는지, 반대 방향으로 변화하는지  
  의미한다.
  

```r
venn.plot <- draw.pairwise.venn(
area1 = 100,
area2 = 100,
cross.area = 0,
category = c("A", "B"),
fill = c("blue", "lightblue"),
lty = "blank",
cex = 2,
cat.cex = 2,
cat.pos = c(-5,0),
cat.dist = 0.09,
cat.just = list(c(-1, -1), c(1, 1)),
ext.dist = -0.05,
ext.length = 0.85,
ext.line.lwd = 2,
ext.line.lty = "dashed"
);
grid.draw(venn.plot);
```

![](/images/blog3_files/figure-html/unnamed-chunk-2-1.png)<!-- -->

```r
grid.newpage();venn.plot <- draw.pairwise.venn(
area1 = 100,
area2 = 100,
cross.area = 20,
category = c("A", "B"),
fill = c("blue", "lightblue"),
lty = "blank",
cex = 2,
cat.cex = 2,
cat.pos = c(-5,0),
cat.dist = 0.09,
cat.just = list(c(-1, -1), c(1, 1)),
ext.dist = -0.05,
ext.length = 0.85,
ext.line.lwd = 2,
ext.line.lty = "dashed"
);
grid.draw(venn.plot);
```

![](/images/blog3_files/figure-html/unnamed-chunk-2-2.png)<!-- -->

```r
grid.newpage();venn.plot <- draw.pairwise.venn(
area1 = 100,
area2 = 100,
cross.area = 70,
category = c("A", "B"),
fill = c("blue", "lightblue"),
lty = "blank",
cex = 2,
cat.cex = 2,
cat.dist = 0.09,
cat.just = list(c(-1, -1), c(1, 1)),
ext.dist = -0.05,
ext.length = 0.85,
ext.line.lwd = 2,
ext.line.lty = "dashed"
);
grid.draw(venn.plot);
```

![](/images/blog3_files/figure-html/unnamed-chunk-2-3.png)<!-- -->
  변화의 강도와 방향을 나타나는 계수가 상관계수(r)이다. 상관계수는
  -1부터 1 사이에 있다. 수치가 클수록 영향을 주는 강도가 큰데 '+'는
  '정의 관계','-'는'부의 관게'또는 '역의 관계'에 있는 것을 의미한다.
  상관계수가 0.3이면, 한 변수가 1단위 변화 할 때 다른 변수가 0.3만큼
  같은 방향으로 진화하는 것을 말한다.
  

```r
##상관관계: -1≥r≥1
```

  상관계수가 ±0.7 이상이면 높은 관계, ±0.4~±0.7 미만이면
  다소 높은 관계,±0.2~±0.4 미만이면 낮은 관계가 있다고 본다.
  ±0.2 미만이면 거의 없다고 해석한다. 0이면 상관관계가 없다.

## 2-4) 회귀분석

  상관관계로는 변수들의 관계를 알 수는 있지만, 인과관계는 알 수 없다.
  인과관계는 원인과 결과의 관계이다. 한 변수가 다른 변수에 영향을
  주는 것을 말한다. 영향을 주는 변수는 독립변수(independent variable)이고,
  영향을 주는 변수는 독립변수(independent variable)이고, 영향을 받는 변수는
  종속 변수(dependent variable)이다. 독립변수와 종속변수 간의 인과관계를
  분석하는 통계적 방법을 회귀분석(regression analysis)라고 한다.
  "월급이 증가하면 외식횟수가 늘어날 것"이라고 가정하면 월급을 독립변수이고
  외식횟수는 종속변수이다. 월급의 증감이 외식횟수에 미치는 영향을 확률적으로
  분석하는 것이 회귀분석이다, 사회과학에서 회귀분석은 통계 분석의 꽃이라고
  불릴 정도로 매우 중요한 통계 분석이다.
    회귀분석에서 독립변수가 1개이면 단순회귀분석, 2개 이상이면 다중회귀분석
  이라고 한다. 단순회귀분석은 1차 함수 y=a+βx에서 β를 찾아내는 것이다. x가 1
  증가하면, y는 𝜷만큼 증가한다. 𝜷를 회귀계수라고 한다. x는 독립변수
  y는 종속변수,a는 상수다. 회귀분석에서 a는 절편이라고 하는데
  통계적인 의미는 없다.
  
  
  다중회귀분석은 종속변수는 1개이며 독립변수가 복수인 경우다. 복수의
  독립 변수들이 종속변수에 영향을 주는 
  정도를 분석하는 것이다. y=a+𝜷₁X₁+𝜷₂X₂+𝜷₃x₃...로 표시된다.
  

## 통계 검정 1)가설

   가설(hypothesis)은 어떤 현상을 설명하기 위해서 가정하는 명제다.
   증명되지 않은 추정이다. 가설에는 귀무가설과 대립가설이 있다.
   귀무가설은 설정한 가설이 맞을 확률이 극히 적어서 처음부터 기각 될 것으로
   예상되는 가설이다. 영가설이라고도 한다. 대립가설은 귀무가설이 기각 될 경우
   받아들여지는 가설이다. 대립가설은 연구자가 검정하고자 하는 가설이다.
   통계 검정은 통계적인 방법을 이용해서 대립가설이 맞는가를 검정하는 것이다.
     두 집단의 평균 차이가 있는가를 알아보려 한다. 평균 차이가 있는지를 검정하는
   것이기 떄문에 귀무가설은 '평균 차이가 없다'이며, 대립가설은'평균차이가 있다'
   이다.
   
## 2) 유의수준

   가설검정의 결과는 유의수준에 의해 결정된다. 유의수준(signficance level)은
   귀무가설이 맞는데도 대립가설을 채택할 확률이다. 즉 오류를 범할 확률이다.
   차이가 없는데도 있다고 할 확률잉다. 통계 분석에서는 p-value(p값)로 제시된다.
   p값이 0.01이라면 오류를 범할 확률이 1%라는 의미다. 오류가 없는 것이
   가장 좋겠지만 현실적으로 오류가 없다는 것은 거의 불가능하다. 통계에서도
   오류가 있기 마련이어서 어느 정도의 오류는 인정 할 수 밖에 없다. 그래서
   '허용 할 수 있는 오류 범위'를 정하게 된다. 유의수준 5%는 오류를 5%까지
   허용하겠다는 의미다. 화살 100발을 쏜느 경우 유의수준 5%는 과녁을 벗어나는
   화살이 5발 이내면 합격한 것으로 보는 것이다. 허용하는 유의수준의 범위와
   정확성은 반대의 개념이다. 유의수준의 범위가 넓으면 연구 결과를 얻기가 쉽지만
   결과의 정확성이 떨어지고, 너무 좁으면 결과를 얻기 어렵다. 100점 만점 시험에서
   90점 이상을 합격으로 할 때와 80점 이상을 합격으로 할 때 합격자의 분포와 질적
   수준은 크게 달라진다. 90점 이상으로 하면 합격자 수는 증가하지만 합격자의
   평균점수는 낮아진다. 가설검정에서 인정하는 유의수준에는 5%,1%,0.1% 등
   세 종류가 있다. 사회과학에서는 5%까지 인정한다. 그러나 정확성이 많이 요구되는
   자연과학이나 의학에서는 유의수준의 허용범위가 더욱 좁아진다. 통계 분석을 하면
   결과물에는 유의수준(p-value)이 적혀 있다. 통계 분석 결과를 해석할 때는
   먼저 유의수준(p-value)이 적혀 있다. 통계 분석 결과를 해석할 때는 먼저
   유의수준이 0.05 이내인가를 보고, 결과가 통계적으로 유의미한지를 판단해야한다.
   유의수준이 0.05이상인데도 결과가 유의미하다고 해석하면 매우 심각한 오류다.
   유의수준의 반대 개념은 신뢰수준(confidence level)이다. 신뢰 할 수 있는
   범위를 의미한다. 유의수준 5% 이내라고 하면 신뢰수준은 95%라고 보면된다.
   
## 3) 척도
  
   척도(scale)는 측정도구이며,수치로 표시된다. 척도에는 명목척도, 서열척도
  등간척도, 비율척도 등 네 종류가 있다 척도의 종류에 따라 통계 분석이 가능하거나
  불가능하기 때문에 분석하기 전에 척도의 종류를 파악해야 한다.
  
## 통계 분석 사례 1) 두 집단의 평균 차이 검정

  남녀 등 두 집단의 평균 차이를 분석할 때는 독립표본 t검정을 한다. R에서는
  내장된 t.test()함수로 한다. 독립변수는 명목척도이며, 종속변수는 등간척도
  또는 비율척도여야한다. t.test()함수를 쓰는 방법은 두가지가 있다
  

```r
##방법1) t.test(data = 데이터셋,종속변수(비교값)~독립변수(비교대상))
##방법2) t.test(데이터세트$종속변수*비교값)~데이터셋$독립변수(비교대상))
```
  예제파일인 mpg1.csv의 trans 변수에는 기어변속 방법으로 auto(자동식)와
  manual(수동식) 등 두 방식이 있다. 두 방식에 따라 cty 평균이 통계적으로
  유의미한 차이가 있는가를 알아보겠다. cty는 도시에서 1갤런당 달리는 거리다
  독립변수는 trans이며, 종속변수는 cty이다. 가설은 다음과 같이 설정한다.


```r
##귀무가설:auto와 manual의 cty 평균은 차이가 없다
##대립가설:auto와 manual의 cty 평균은 차이가 있다
```

```r
##t.test(data=mpg1, cty~trans)
```

내용을 보면 p-value=1.263e-05이다. 유의수준이 1.263e-05라는 뜻이다.
지수표시에서 'e-n'은 '10의 n승분의 1(1/10)'이며, 'e+n'은 '10의 n승'을 의미한다.
따라서 1.263e-05는 1.263/100000이다.
  
  
  
## 2) 교차분석

교차분석은 범주형 변수들이 관계가 있다는 것을 입증하는 것이다.
평균의 차이가 아니라, 비율에 차이가 있는지를 검정한다. 교차분석 검정은 R의
chisq.test() 함수로 한다.


```r
##table(mpg1$trans, mpg1$drv)
##prop.table(table(mpg1$trans, mpg1$drv),1)
```

## 3) 상관관계분석
 
  상관관계분석은 R에 내장되어 있는 cor.test() 함수로 한다.
  mpg1에는 cty와 hwy가 있다. cty는 도시에서 1갤런당 달리는 거리다.
  hwy는 고속도로에서 1갤런당 달리는 거리다. cty가 길면 hwy도 길 것이라고
  생각 할 수 있다. 이 가설을 검정해보겠다. 검정하려는 가설은 cty와 hwy는
  서로 상관관계가 있다는 것이기 때문에 이것이 대립가설이다. 귀무가설은
  상관관계가 없다는 것이다.
  

```r
##cor.test(mpg1$cty, mpg1$hwy)
```

## 4)회귀분석

  단순회귀분석은 독립변수가 1개, 종속변수가 1개일 때 한다. 회귀분석의
  변수는 독립변수와 종속변수가 모두 등간척도 또는 비율척도여야 한다.
  회귀분석은 R의 Im() 함수로 한다. 세 방법 중 어느 것을 써도 된다.
  
  
   R에 있는 mtcars 데이터세트로 분석해보겠다. R에서 help(mtcars)를 하면
   mtcars에 관한 정보를 알 수 있다. 1974년 <Motor Trend>라는 미국 잡지에
   실린 데이터이다. 11개 변수에서 32개 자동의 정보를 담고 있다. 11개 변수 가운데
   disp(배기량)가 mpg(1갤런당 주행 마일)에 미치는 영향을 분석하겠다.
   str(mtcar)로 mtcars에 있는 변수들을 보면, disp와 mpg는 모두 실수형(num)
   변수이어서 회귀분석이 가능하다. 가설은 다음과 같이 설정한다
   

```r
lm(data=mtcars, mpg~disp)
```

```
## 
## Call:
## lm(formula = mpg ~ disp, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp  
##    29.59985     -0.04122
```
   하지만 유의수준이 들어가 있지 않다 유의수준에 따라 통계적 의미는 달라진다.
   유의수준이 0.05 이상이면 이 회귀계수는 의미가 없다. 그렇기 때문에
   회귀분석의 유의수준 값을 알아봐야 한다. lm()의 결과를 summary()함수에 넣으면
   유의수준을 비롯해서 상세한 회귀분석 결과를 알 수 있다.
   

```r
RA <- lm(data=mtcars, mpg~disp)

summary(RA)
```

```
## 
## Call:
## lm(formula = mpg ~ disp, data = mtcars)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.8922 -2.2022 -0.9631  1.6272  7.2305 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 29.599855   1.229720  24.070  < 2e-16 ***
## disp        -0.041215   0.004712  -8.747 9.38e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.251 on 30 degrees of freedom
## Multiple R-squared:  0.7183,	Adjusted R-squared:  0.709 
## F-statistic: 76.51 on 1 and 30 DF,  p-value: 9.38e-10
```

## 2) 다중회귀분석

  다중회귀분석은 종속변수에 영향을 주는 독립변수가 복수일 때 분석하는 방식이다.
  여러 독립변수들은 서로 영향을 주면서 종속변수에 영향을 주기 때문에 한 독립변수가
  종속변수에 미치는 영향력은 단순회귀분석을 했을 때와 다중회귀분석을 했을 때에
  달라진다. 다중회귀분석에서는 단순회귀분석의 독립변수들을 '+'기호로 연결한다.



```r
lm(data=mtcars, mpg~disp+hp+wt)
```

```
## 
## Call:
## lm(formula = mpg ~ disp + hp + wt, data = mtcars)
## 
## Coefficients:
## (Intercept)         disp           hp           wt  
##   37.105505    -0.000937    -0.031157    -3.800891
```

 다중 회귀식은 mpg=37.105505-0.000937x야네-0.031157x hp - 3.800891 x wt이다
 그러나 세 독립변수의 회귀계수에 대한 유의 수준이 없어서 회귀계수가 유의미한
 지를 알 수 없다. summary()함수로 유의 수준을 비롯한 상세 결과를 알아보겠다.


```r
RA<- lm(data=mtcars, mpg~disp+hp+wt)

summary(RA)
```

```
## 
## Call:
## lm(formula = mpg ~ disp + hp + wt, data = mtcars)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -3.891 -1.640 -0.172  1.061  5.861 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) 37.105505   2.110815  17.579  < 2e-16 ***
## disp        -0.000937   0.010350  -0.091  0.92851    
## hp          -0.031157   0.011436  -2.724  0.01097 *  
## wt          -3.800891   1.066191  -3.565  0.00133 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.639 on 28 degrees of freedom
## Multiple R-squared:  0.8268,	Adjusted R-squared:  0.8083 
## F-statistic: 44.57 on 3 and 28 DF,  p-value: 8.65e-11
```

